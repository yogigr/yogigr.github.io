{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/deploy-laravel-dengan-github-actions/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Yogigr"}},"markdownRemark":{"id":"c7fc507b-96d5-57d6-a814-115563545617","excerpt":"Pengantar Github Actions adalah layanan gratis dari github yang bisa berjalan di repository yang terkonfigurasi. Dalam tutorial ini saya manfaatkan layanan iniâ€¦","html":"<h3>Pengantar</h3>\n<p>Github Actions adalah layanan gratis dari github yang bisa berjalan di repository yang terkonfigurasi. Dalam tutorial ini saya manfaatkan layanan ini untuk deploy Laravel secara otomatis.</p>\n<h3>Persiapan</h3>\n<p>Sebelum melakukuan konfigurasi, ada hal yang perlu saya siapkan, diantaranya:</p>\n<ol>\n<li>Server/Vps yang sudah terkonfigurasi web server, mysql dan php. <a href=\"/instalasi-lamp-di-ubuntu-18-04/\">Cara Instalasi LAMP (Linux, Apache, Mysql, PHP) di Ubuntu 18.04</a></li>\n<li>Repository Github</li>\n</ol>\n<h3>Setup git</h3>\n<p>Terdapat 3 branch diantaranya:</p>\n<ul>\n<li><strong>main</strong>, branch untuk development</li>\n<li><strong>production</strong>, branch yang kita push ke github</li>\n<li><strong>deploy</strong>, branch yang terbuat otomatis ketika workflow dari github actions berjalan</li>\n</ul>\n<p>Sehingga flow nya seperti: <strong>main</strong> -> <strong>production</strong> -> <strong>deploy</strong></p>\n<h3>Server Deployment Script</h3>\n<p>Buat file bash script, saya beri nama <strong>server_deploy.sh</strong>. Script ini akan berjalan di server.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">#/!bin/sh</span>\n\n<span class=\"token builtin class-name\">set</span> -e\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Deploying application ...\"</span>\n\n<span class=\"token comment\">#Enter maintenance mode</span>\n<span class=\"token punctuation\">(</span>php artisan down <span class=\"token string\">'Web sedang dalam pemeliharaan. Silahkan kembali beberapa saat lagi'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">true</span>\n  <span class=\"token comment\">#update codebase</span>\n  <span class=\"token function\">git</span> fetch origin deploy\n  <span class=\"token function\">git</span> reset --hard origin/deploy\n\n  <span class=\"token comment\"># Install dependencies based on lock file</span>\n  <span class=\"token function\">composer</span> <span class=\"token function\">install</span> --optimize-autoloader --no-dev\n\n  <span class=\"token comment\"># Migrate database</span>\n  php artisan migrate --force\n\n  <span class=\"token comment\"># Note: If you're using queue workers, this is the place to restart them.</span>\n  <span class=\"token comment\"># ...</span>\n\n  <span class=\"token comment\"># Clear cache</span>\n  php artisan optimize\n\n  <span class=\"token comment\"># Reload PHP to update opcache</span>\n  <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">sudo</span> -S <span class=\"token function\">service</span> php7.4-fpm reload\n\n<span class=\"token comment\"># Exit maintenance mode</span>\nphp artisan up\n\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Application deployed!\"</span></code></pre></div>\n<h3>Local Deployment Script</h3>\n<p>Buat file bash lagi, saya kasih nama <strong>deploy.sh</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\">#/!bin/sh</span>\n\n<span class=\"token builtin class-name\">set</span> -e\n\nvendor/bin/phpunit\n\n<span class=\"token punctuation\">(</span>git push<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">true</span>\n\n<span class=\"token function\">git</span> checkout production\n<span class=\"token function\">git</span> merge main\n\n<span class=\"token function\">git</span> push origin production\n\n<span class=\"token function\">git</span> checkout main</code></pre></div>\n<h3>Github Actions</h3>\n<p>Create file <strong>.github/workflows/main.yml</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">name: CD\n \non:\n  push:\n    branches: <span class=\"token punctuation\">[</span> production <span class=\"token punctuation\">]</span>\n \njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v2\n      with:\n        token: <span class=\"token variable\">${{ secrets.PUSH_TOKEN }</span><span class=\"token punctuation\">}</span>\n    - name: Set up Node\n      uses: actions/setup-node@v1\n      with:\n        node-version: <span class=\"token string\">'12.x'</span>\n    - run: <span class=\"token function\">npm</span> <span class=\"token function\">install</span>\n    - run: <span class=\"token function\">npm</span> run production\n    - name: Commit built assets\n      run: <span class=\"token operator\">|</span>\n        <span class=\"token function\">git</span> config --local user.email <span class=\"token string\">\"myemail@email.com\"</span>\n        <span class=\"token function\">git</span> config --local user.name <span class=\"token string\">\"My Name\"</span>\n        <span class=\"token function\">git</span> checkout -B deploy\n        <span class=\"token function\">git</span> <span class=\"token function\">add</span> -f public/\n        <span class=\"token function\">git</span> commit --allow-empty -m <span class=\"token string\">\"Build front-end assets\"</span>\n        <span class=\"token function\">git</span> push -f origin deploy\n    - name: Deploy to production\n      uses: appleboy/ssh-action@master\n      with:\n        username: <span class=\"token variable\">${{ secrets.SSH_USER }</span><span class=\"token punctuation\">}</span>\n        host: <span class=\"token variable\">${{ secrets.SSH_HOST }</span><span class=\"token punctuation\">}</span>\n        password: <span class=\"token variable\">${{ secrets.SSH_PASSWORD }</span><span class=\"token punctuation\">}</span>\n        script: <span class=\"token string\">'cd /var/www/html/appdir &amp;&amp; ./server_deploy.sh'</span></code></pre></div>\n<p><strong>PUSH_TOKEN</strong>, <strong>SSH_USER</strong>, <strong>SSH_HOST</strong>, dan <strong>SSH_PASSWORD</strong>, saya isi masing-masing variable di Tab Settings -> Secrets.\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d470bfa80a14d91cc4092ced8149a716/aa878/secrets.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKElEQVQoz5WR227EIAxE8/8f2m02NyDgCyGZyk5a5WW7rSULZNDxeNzFGDFNM0IImJcF/4kDQIgrQkxYQoRoRZfSinleHLYsAcwCVQUxoxD5XUSQcwEzQ0X8JGL/Y7B5CTBOazu6j8cDwzAihOgqh3H0Bs9hQN8/vTaOEz77HpM1jgUhFZRSQEQXnFBrddWddfduxP54T6v5O5+njUT1QG0vLDgOdNrsE2OVjG1vb32rqq7utKMiphVUCByvkWVTkDK4ind4l1qrK2YR1LphLQRhgeRyAvUCFiXs+/4rzMKBdAG3E8h34LfCSAlZyo8XL4GqyL4Q9kWkNYPN65TRdgNWddBqsANvFYoB87lhUxsNePfQxmx78/yLh601bFcawMa2Wts23/IXA5cO11QOVUwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Secrets Variable\"\n        title=\"Secrets Variable\"\n        src=\"/static/d470bfa80a14d91cc4092ced8149a716/f058b/secrets.png\"\n        srcset=\"/static/d470bfa80a14d91cc4092ced8149a716/c26ae/secrets.png 158w,\n/static/d470bfa80a14d91cc4092ced8149a716/6bdcf/secrets.png 315w,\n/static/d470bfa80a14d91cc4092ced8149a716/f058b/secrets.png 630w,\n/static/d470bfa80a14d91cc4092ced8149a716/40601/secrets.png 945w,\n/static/d470bfa80a14d91cc4092ced8149a716/78612/secrets.png 1260w,\n/static/d470bfa80a14d91cc4092ced8149a716/aa878/secrets.png 1385w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\nSesuaikan juga nama directory dengan mengganti <strong>appdir</strong>.</p>\n<h3>Penggunaan</h3>\n<ol>\n<li>Push branch <strong>main</strong> dan <strong>production</strong> ke github</li>\n<li>Login server dan clone repo dari github. Saya clone menggunakan metode menyisipkan token, supaya setiap deploy tidak selalu meminta login github. <a href=\"/akses-repository-github-tanpa-login/\">Akses Repository Github tanpa Login</a></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> /var/www/html <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> clone https://c904a061a164cb45a9abf5dbc6c8b8f4c16d6xxx@github.com/user/test.git myapp</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> myapp <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> checkout production <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">git</span> checkout -b deploy</code></pre></div>\n<ol start=\"3\">\n<li>Dari local repo kita jalankan perintah:</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">./deploy.sh</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e18db530cfc85c921e82b5fbcd28a278/f0811/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.49367088607595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABTklEQVQoz52TXU/CMBiF9y/QCCLse5RtZXxNwWkUlEwQMKDGC5UwlSXGKxMv/O/HtGRzJCDgxZPTZe3p6du3QjB7x+3DIy67Q1z4A06r01tJ2++jO7xD7+YeV4Mx/P4Ifn8M/3rEPYTGSRuiZiGvFpFTGAQZUUcmz9ASzL/3RQMKcaCZFcgG5WtF3Yo9BO+8A92sgFYb0IoORM2EbNh/wuYwJJ1hxSgFCsE764DQOpz6MTe1yoegtSZXie9sxhqNVxEbFmhtwcx03LWLk0RzWfqFhMlUyUTrzKP/SxMW7Gpcp20TqqT0a1iqNWFXjriqxPmX4dKErH6sdba5jIUanrZ8FB03vmWmLGl0dLbrJqiE8rYTyq6HrEz4MSXdRjo3b969AwWptIidzHpSXCXsZmUIn1/fmLyEeA0/wJ7h0/SN8zydYRKEmASzDQm5zw/u+H+WWq+7eAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Deploy result\"\n        title=\"Deploy result\"\n        src=\"/static/e18db530cfc85c921e82b5fbcd28a278/f058b/result.png\"\n        srcset=\"/static/e18db530cfc85c921e82b5fbcd28a278/c26ae/result.png 158w,\n/static/e18db530cfc85c921e82b5fbcd28a278/6bdcf/result.png 315w,\n/static/e18db530cfc85c921e82b5fbcd28a278/f058b/result.png 630w,\n/static/e18db530cfc85c921e82b5fbcd28a278/40601/result.png 945w,\n/static/e18db530cfc85c921e82b5fbcd28a278/78612/result.png 1260w,\n/static/e18db530cfc85c921e82b5fbcd28a278/f0811/result.png 1367w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"Deploy Laravel dengan Github Actions","date":"October 01, 2021","description":"Github Actions adalah layanan gratis dari github yang bisa berjalan di repository yang terkonfigurasi. Dalam tutorial ini saya manfaatkan layanan ini untuk deploy Laravel secara otomatis."}},"previous":{"fields":{"slug":"/akses-repository-github-tanpa-login/"},"frontmatter":{"title":"Akses Repository Github tanpa Login"}},"next":{"fields":{"slug":"/laravel-broadcasting-dengan-redis-dan-socketio/"},"frontmatter":{"title":"Laravel Broadcasting dengan Redis dan Socket.IO"}}},"pageContext":{"id":"c7fc507b-96d5-57d6-a814-115563545617","previousPostId":"9f659ded-5295-54e9-a5ac-6a91cd33466e","nextPostId":"cf51f2b0-97b5-58a1-bbf0-77f6540e3124"}},
    "staticQueryHashes": ["2841359383","3257411868"]}